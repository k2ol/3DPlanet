<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Solar System Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        button.active {
            background: #2196F3;
        }

        select {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 14px;
            margin: 5px;
            min-width: 120px;
        }

        select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        #planet-info {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
            display: none;
        }

        #planet-info h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        #planet-info p {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            padding: 0;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <p data-en="Loading Solar System..." data-zh="正在加载太阳系...">Loading Solar System...</p>
    </div>

    <div id="container">
        <div id="controls">
            <div class="control-group">
                <label data-en="Language / 语言" data-zh="语言 / Language">Language / 语言</label>
                <button id="lang-en" class="active" onclick="setLanguage('en')">English</button>
                <button id="lang-zh" onclick="setLanguage('zh')">中文</button>
            </div>
            
            <div class="control-group">
                <label data-en="View Mode" data-zh="视图模式">View Mode</label>
                <button id="mode-3d" class="active" onclick="setViewMode('3d')" data-en="3D View" data-zh="3D视图">3D View</button>
                <button id="mode-2d" onclick="setViewMode('2d')" data-en="2D View" data-zh="2D视图">2D View</button>
            </div>
            
            <div class="control-group">
                <label data-en="Animation" data-zh="动画">Animation</label>
                <button id="toggle-animation" onclick="toggleAnimation()" data-en="Pause" data-zh="暂停">Pause</button>
                <button onclick="resetView()" data-en="Reset View" data-zh="重置视图">Reset View</button>
            </div>
            
            <div class="control-group">
                <label data-en="Speed" data-zh="速度">Speed</label>
                <input type="range" id="speed-slider" min="0.1" max="5" step="0.1" value="1" onchange="setAnimationSpeed(this.value)">
                <span id="speed-value">1x</span>
            </div>
            
            <div class="control-group">
                <label data-en="Observation Center" data-zh="观测中心">Observation Center</label>
                <select id="observation-center" onchange="setObservationCenter(this.value)">
                    <option value="sun" data-en="Sun" data-zh="太阳">Sun</option>
                    <option value="mercury" data-en="Mercury" data-zh="水星">Mercury</option>
                    <option value="venus" data-en="Venus" data-zh="金星">Venus</option>
                    <option value="earth" data-en="Earth" data-zh="地球">Earth</option>
                    <option value="mars" data-en="Mars" data-zh="火星">Mars</option>
                    <option value="jupiter" data-en="Jupiter" data-zh="木星">Jupiter</option>
                    <option value="saturn" data-en="Saturn" data-zh="土星">Saturn</option>
                    <option value="uranus" data-en="Uranus" data-zh="天王星">Uranus</option>
                    <option value="neptune" data-en="Neptune" data-zh="海王星">Neptune</option>
                </select>
                <button onclick="followPlanet()" id="follow-btn" data-en="Follow Planet" data-zh="跟随行星">Follow Planet</button>
            </div>
            
            <div class="control-group">
                <label data-en="Display Options" data-zh="显示选项">Display Options</label>
                <button id="toggle-orbits" onclick="toggleOrbits()" data-en="Hide Orbits" data-zh="隐藏轨道">Hide Orbits</button>
                <button id="toggle-moons" onclick="toggleMoons()" data-en="Hide Moons" data-zh="隐藏卫星">Hide Moons</button>
                <button id="toggle-asteroids" onclick="toggleAsteroids()" data-en="Hide Asteroids" data-zh="隐藏小行星">Hide Asteroids</button>
            </div>
        </div>

        <div id="planet-info">
            <button class="close-btn" onclick="closePlanetInfo()">×</button>
            <h3 id="planet-name"></h3>
            <p><strong data-en="Distance from Sun:" data-zh="距离太阳:">Distance from Sun:</strong> <span id="planet-distance"></span></p>
            <p><strong data-en="Diameter:" data-zh="直径:">Diameter:</strong> <span id="planet-diameter"></span></p>
            <p><strong data-en="Orbital Period:" data-zh="公转周期:">Orbital Period:</strong> <span id="planet-period"></span></p>
            <p><strong data-en="Description:" data-zh="描述:">Description:</strong></p>
            <p id="planet-description"></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let planets = [];
        let moons = [];
        let asteroids = [];
        let sun;
        let animationSpeed = 1;
        let isAnimating = true;
        let currentViewMode = '3d';
        let currentLanguage = 'en';
        let showOrbits = true;
        let showMoons = true;
        let showAsteroids = true;
        let observationCenter = 'sun';
        let followMode = false;
        let cameraOffset = { x: 0, y: 20, z: 50 };

        // Planet data
        const planetData = {
            sun: {
                name: { en: 'Sun', zh: '太阳' },
                radius: 5,
                distance: 0,
                speed: 0,
                color: 0xFDB813,
                description: {
                    en: 'The Sun is the star at the center of the Solar System. It is a nearly perfect sphere of hot plasma.',
                    zh: '太阳是太阳系中心的恒星，是一个几乎完美的热等离子体球。'
                },
                diameter: '1,392,700 km',
                period: 'N/A'
            },
            mercury: {
                name: { en: 'Mercury', zh: '水星' },
                radius: 0.8,
                distance: 15,
                speed: 0.02,
                color: 0x8C7853,
                description: {
                    en: 'Mercury is the smallest planet in our solar system and closest to the Sun.',
                    zh: '水星是太阳系中最小的行星，也是距离太阳最近的行星。'
                },
                diameter: '4,879 km',
                period: '88 days'
            },
            venus: {
                name: { en: 'Venus', zh: '金星' },
                radius: 1.2,
                distance: 22,
                speed: 0.015,
                color: 0xFFC649,
                description: {
                    en: 'Venus is the second planet from the Sun and is Earth\'s closest planetary neighbor.',
                    zh: '金星是距离太阳第二近的行星，是地球最近的行星邻居。'
                },
                diameter: '12,104 km',
                period: '225 days'
            },
            earth: {
                name: { en: 'Earth', zh: '地球' },
                radius: 1.3,
                distance: 30,
                speed: 0.01,
                color: 0x6B93D6,
                description: {
                    en: 'Earth is the third planet from the Sun and the only known planet to harbor life. It has one natural satellite, the Moon.',
                    zh: '地球是距离太阳第三近的行星，也是已知唯一有生命存在的行星。它有一颗天然卫星——月球。'
                },
                diameter: '12,756 km',
                period: '365 days',
                moons: [{
                    name: { en: 'Moon', zh: '月球' },
                    radius: 0.3,
                    distance: 3,
                    speed: 0.05,
                    color: 0xC0C0C0,
                    description: {
                        en: 'The Moon is Earth\'s only natural satellite and the fifth largest moon in the Solar System.',
                        zh: '月球是地球唯一的天然卫星，也是太阳系中第五大的卫星。'
                    }
                }]
            },
            mars: {
                name: { en: 'Mars', zh: '火星' },
                radius: 1.0,
                distance: 40,
                speed: 0.008,
                color: 0xC1440E,
                description: {
                    en: 'Mars is the fourth planet from the Sun and is known as the Red Planet.',
                    zh: '火星是距离太阳第四近的行星，被称为红色星球。'
                },
                diameter: '6,792 km',
                period: '687 days'
            },
            jupiter: {
                name: { en: 'Jupiter', zh: '木星' },
                radius: 3.5,
                distance: 60,
                speed: 0.005,
                color: 0xD8CA9D,
                description: {
                    en: 'Jupiter is the largest planet in our solar system and is known for its Great Red Spot. It has 95 known moons including the four largest: Io, Europa, Ganymede, and Callisto.',
                    zh: '木星是太阳系中最大的行星，以其大红斑而闻名。它有95颗已知卫星，包括四颗最大的：木卫一、木卫二、木卫三和木卫四。'
                },
                diameter: '142,984 km',
                period: '12 years',
                moons: [
                    {
                        name: { en: 'Io', zh: '木卫一' },
                        radius: 0.2,
                        distance: 5,
                        speed: 0.08,
                        color: 0xFFFF99,
                        description: {
                            en: 'Io is the most volcanically active body in the Solar System.',
                            zh: '木卫一是太阳系中火山活动最活跃的天体。'
                        }
                    },
                    {
                        name: { en: 'Europa', zh: '木卫二' },
                        radius: 0.18,
                        distance: 6.5,
                        speed: 0.06,
                        color: 0xADD8E6,
                        description: {
                            en: 'Europa has a subsurface ocean that may harbor life.',
                            zh: '木卫二有一个可能孕育生命的地下海洋。'
                        }
                    },
                    {
                        name: { en: 'Ganymede', zh: '木卫三' },
                        radius: 0.25,
                        distance: 8,
                        speed: 0.04,
                        color: 0x8B7D6B,
                        description: {
                            en: 'Ganymede is the largest moon in the Solar System.',
                            zh: '木卫三是太阳系中最大的卫星。'
                        }
                    },
                    {
                        name: { en: 'Callisto', zh: '木卫四' },
                        radius: 0.22,
                        distance: 10,
                        speed: 0.03,
                        color: 0x696969,
                        description: {
                            en: 'Callisto is the most heavily cratered object in the Solar System.',
                            zh: '木卫四是太阳系中陨石坑最多的天体。'
                        }
                    }
                ]
            },
            saturn: {
                name: { en: 'Saturn', zh: '土星' },
                radius: 3.0,
                distance: 80,
                speed: 0.003,
                color: 0xFAD5A5,
                description: {
                    en: 'Saturn is the sixth planet from the Sun and is famous for its prominent ring system. It has 146 known moons, with Titan being the largest.',
                    zh: '土星是距离太阳第六近的行星，以其突出的环系统而闻名。它有146颗已知卫星，其中土卫六是最大的。'
                },
                diameter: '120,536 km',
                period: '29 years',
                hasRings: true,
                moons: [
                    {
                        name: { en: 'Titan', zh: '土卫六' },
                        radius: 0.24,
                        distance: 7,
                        speed: 0.04,
                        color: 0xFFA500,
                        description: {
                            en: 'Titan has a thick atmosphere and liquid methane lakes.',
                            zh: '土卫六有浓厚的大气层和液态甲烷湖泊。'
                        }
                    },
                    {
                        name: { en: 'Enceladus', zh: '土卫二' },
                        radius: 0.12,
                        distance: 5,
                        speed: 0.06,
                        color: 0xF0F8FF,
                        description: {
                            en: 'Enceladus has geysers of water ice erupting from its south pole.',
                            zh: '土卫二的南极有水冰间歇泉喷发。'
                        }
                    }
                ]
            },
            uranus: {
                name: { en: 'Uranus', zh: '天王星' },
                radius: 2.0,
                distance: 100,
                speed: 0.002,
                color: 0x4FD0E7,
                description: {
                    en: 'Uranus is the seventh planet from the Sun and rotates on its side.',
                    zh: '天王星是距离太阳第七近的行星，侧着旋转。'
                },
                diameter: '51,118 km',
                period: '84 years'
            },
            neptune: {
                name: { en: 'Neptune', zh: '海王星' },
                radius: 1.9,
                distance: 120,
                speed: 0.001,
                color: 0x4B70DD,
                description: {
                    en: 'Neptune is the eighth and outermost planet in our solar system.',
                    zh: '海王星是太阳系中第八颗也是最外层的行星。'
                },
                diameter: '49,528 km',
                period: '165 years'
            }
        };

        // Initialize the scene
        function init() {
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 50, 100);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000011);
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Add controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            const pointLight = new THREE.PointLight(0xffffff, 1, 300);
            pointLight.position.set(0, 0, 0);
            scene.add(pointLight);
            
            // Create stars
            createStars();
            
            // Create sun and planets
            createSun();
            createPlanets();
            createMoons();
            createAsteroidBelt();
            
            // Hide loading screen
            document.getElementById('loading').classList.add('hidden');
            
            // Start animation
            animate();
        }

        function createStars() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.5 });
            
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
        }

        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(planetData.sun.radius, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({ 
                color: planetData.sun.color,
                emissive: planetData.sun.color,
                emissiveIntensity: 0.3
            });
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.userData = { planetKey: 'sun', data: planetData.sun };
            scene.add(sun);
        }

        function createPlanets() {
            Object.keys(planetData).forEach(key => {
                if (key === 'sun') return;
                
                const data = planetData[key];
                const geometry = new THREE.SphereGeometry(data.radius, 16, 16);
                const material = new THREE.MeshLambertMaterial({ color: data.color });
                const planet = new THREE.Mesh(geometry, material);
                
                planet.position.x = data.distance;
                planet.userData = { 
                    planetKey: key,
                    data: data,
                    angle: Math.random() * Math.PI * 2,
                    distance: data.distance,
                    speed: data.speed
                };
                
                // Add orbit line
                const orbitGeometry = new THREE.RingGeometry(data.distance - 0.1, data.distance + 0.1, 64);
                const orbitMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x444444, 
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.3
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = Math.PI / 2;
                orbit.userData = { type: 'orbit' };
                scene.add(orbit);
                
                // Add rings for Saturn
                if (data.hasRings) {
                    const ringGeometry = new THREE.RingGeometry(data.radius + 0.5, data.radius + 2, 32);
                    const ringMaterial = new THREE.MeshBasicMaterial({ 
                        color: 0xC4A484, 
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.6
                    });
                    const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                    rings.rotation.x = Math.PI / 2;
                    rings.userData = { type: 'rings', parent: planet };
                    scene.add(rings);
                }
                
                planets.push(planet);
                scene.add(planet);
            });
            
            // Add click event listener
            addClickListener();
        }

        function createMoons() {
            Object.keys(planetData).forEach(planetKey => {
                if (planetKey === 'sun' || !planetData[planetKey].moons) return;
                
                const planetData_item = planetData[planetKey];
                planetData_item.moons.forEach(moonData => {
                    const geometry = new THREE.SphereGeometry(moonData.radius, 8, 8);
                    const material = new THREE.MeshLambertMaterial({ color: moonData.color });
                    const moon = new THREE.Mesh(geometry, material);
                    
                    moon.userData = {
                        planetKey: planetKey,
                        data: moonData,
                        angle: Math.random() * Math.PI * 2,
                        distance: moonData.distance,
                        speed: moonData.speed,
                        parentDistance: planetData_item.distance,
                        type: 'moon'
                    };
                    
                    moons.push(moon);
                    scene.add(moon);
                });
            });
        }

        function createAsteroidBelt() {
            // Create asteroid belt between Mars and Jupiter
            for (let i = 0; i < 200; i++) {
                const geometry = new THREE.SphereGeometry(Math.random() * 0.1 + 0.02, 4, 4);
                const material = new THREE.MeshLambertMaterial({ color: 0x8C7853 });
                const asteroid = new THREE.Mesh(geometry, material);
                
                const distance = 45 + Math.random() * 10; // Between Mars (40) and Jupiter (60)
                const angle = Math.random() * Math.PI * 2;
                
                asteroid.position.x = Math.cos(angle) * distance;
                asteroid.position.z = Math.sin(angle) * distance;
                asteroid.position.y = (Math.random() - 0.5) * 2;
                
                asteroid.userData = {
                    angle: angle,
                    distance: distance,
                    speed: 0.006 + Math.random() * 0.002,
                    type: 'asteroid'
                };
                
                asteroids.push(asteroid);
                scene.add(asteroid);
            }
        }

        function addClickListener() {
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            
            renderer.domElement.addEventListener('click', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects([sun, ...planets, ...moons]);
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    showPlanetInfo(clickedObject.userData);
                }
            });
        }

        function showPlanetInfo(userData) {
            const info = document.getElementById('planet-info');
            const data = userData.data;
            
            document.getElementById('planet-name').textContent = data.name[currentLanguage];
            document.getElementById('planet-distance').textContent = userData.planetKey === 'sun' ? 'N/A' : `${data.distance * 5.9} million km`;
            document.getElementById('planet-diameter').textContent = data.diameter;
            document.getElementById('planet-period').textContent = data.period;
            document.getElementById('planet-description').textContent = data.description[currentLanguage];
            
            info.style.display = 'block';
        }

        function closePlanetInfo() {
            document.getElementById('planet-info').style.display = 'none';
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (isAnimating) {
                // Rotate sun
                sun.rotation.y += 0.005 * animationSpeed;
                
                // Move planets
                planets.forEach(planet => {
                    const userData = planet.userData;
                    userData.angle += userData.speed * animationSpeed;
                    
                    if (currentViewMode === '3d') {
                        planet.position.x = Math.cos(userData.angle) * userData.distance;
                        planet.position.z = Math.sin(userData.angle) * userData.distance;
                    } else {
                        planet.position.x = Math.cos(userData.angle) * userData.distance;
                        planet.position.z = 0;
                    }
                    
                    planet.rotation.y += 0.01 * animationSpeed;
                    
                    // Update Saturn's rings
                    scene.children.forEach(child => {
                        if (child.userData.type === 'rings' && child.userData.parent === planet) {
                            child.position.copy(planet.position);
                        }
                    });
                });
                
                // Move moons around their planets
                moons.forEach(moon => {
                    if (!showMoons) return;
                    
                    const userData = moon.userData;
                    userData.angle += userData.speed * animationSpeed;
                    
                    // Find parent planet position
                    const parentPlanet = planets.find(p => p.userData.planetKey === userData.planetKey);
                    if (parentPlanet) {
                        const moonX = parentPlanet.position.x + Math.cos(userData.angle) * userData.distance;
                        const moonZ = parentPlanet.position.z + Math.sin(userData.angle) * userData.distance;
                        
                        if (currentViewMode === '3d') {
                            moon.position.set(moonX, 0, moonZ);
                        } else {
                            moon.position.set(moonX, 0, 0);
                        }
                    }
                });
                
                // Move asteroids
                asteroids.forEach(asteroid => {
                    if (!showAsteroids) return;
                    
                    const userData = asteroid.userData;
                    userData.angle += userData.speed * animationSpeed;
                    
                    if (currentViewMode === '3d') {
                        asteroid.position.x = Math.cos(userData.angle) * userData.distance;
                        asteroid.position.z = Math.sin(userData.angle) * userData.distance;
                    } else {
                        asteroid.position.x = Math.cos(userData.angle) * userData.distance;
                        asteroid.position.z = 0;
                    }
                    
                    asteroid.rotation.x += 0.02 * animationSpeed;
                    asteroid.rotation.y += 0.01 * animationSpeed;
                });
            }
            
            // Update camera position based on observation center
            updateCameraPosition();
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Control functions
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-zh').classList.toggle('active', lang === 'zh');
            
            // Update all text elements
            document.querySelectorAll('[data-en]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
            
            // Update select options
            const select = document.getElementById('observation-center');
            Array.from(select.options).forEach(option => {
                const planetKey = option.value;
                if (planetData[planetKey]) {
                    option.textContent = planetData[planetKey].name[lang];
                }
            });
            
            // Update follow button if needed
            const followBtn = document.getElementById('follow-btn');
            if (followMode) {
                followBtn.textContent = lang === 'en' ? 'Stop Following' : '停止跟随';
            } else {
                followBtn.textContent = lang === 'en' ? 'Follow Planet' : '跟随行星';
            }
            
            // Update toggle buttons
            updateToggleButtonTexts();
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            
            // Update button states
            document.getElementById('mode-3d').classList.toggle('active', mode === '3d');
            document.getElementById('mode-2d').classList.toggle('active', mode === '2d');
            
            // Reset camera position for 2D mode
            if (mode === '2d') {
                camera.position.set(0, 0, 150);
                controls.reset();
            }
        }

        function toggleAnimation() {
            isAnimating = !isAnimating;
            const button = document.getElementById('toggle-animation');
            button.textContent = isAnimating ? 
                (currentLanguage === 'en' ? 'Pause' : '暂停') : 
                (currentLanguage === 'en' ? 'Play' : '播放');
        }

        function setAnimationSpeed(speed) {
            animationSpeed = parseFloat(speed);
            document.getElementById('speed-value').textContent = speed + 'x';
        }

        function resetView() {
            controls.reset();
            camera.position.set(0, 50, 100);
        }

        function toggleOrbits() {
            showOrbits = !showOrbits;
            const button = document.getElementById('toggle-orbits');
            
            scene.children.forEach(child => {
                if (child.userData.type === 'orbit') {
                    child.visible = showOrbits;
                }
            });
            
            button.textContent = showOrbits ? 
                (currentLanguage === 'en' ? 'Hide Orbits' : '隐藏轨道') : 
                (currentLanguage === 'en' ? 'Show Orbits' : '显示轨道');
        }

        function toggleMoons() {
            showMoons = !showMoons;
            const button = document.getElementById('toggle-moons');
            
            moons.forEach(moon => {
                moon.visible = showMoons;
            });
            
            button.textContent = showMoons ? 
                (currentLanguage === 'en' ? 'Hide Moons' : '隐藏卫星') : 
                (currentLanguage === 'en' ? 'Show Moons' : '显示卫星');
        }

        function toggleAsteroids() {
            showAsteroids = !showAsteroids;
            const button = document.getElementById('toggle-asteroids');
            
            asteroids.forEach(asteroid => {
                asteroid.visible = showAsteroids;
            });
            
            button.textContent = showAsteroids ? 
                (currentLanguage === 'en' ? 'Hide Asteroids' : '隐藏小行星') : 
                (currentLanguage === 'en' ? 'Show Asteroids' : '显示小行星');
        }

        function setObservationCenter(centerKey) {
            observationCenter = centerKey;
            followMode = false;
            
            // Update follow button text
            const followBtn = document.getElementById('follow-btn');
            followBtn.textContent = currentLanguage === 'en' ? 'Follow Planet' : '跟随行星';
            followBtn.classList.remove('active');
            
            // Reset camera controls
            controls.enabled = true;
            
            // Move camera to new observation center
            const centerObject = getCenterObject(centerKey);
            if (centerObject) {
                const targetPos = centerObject.position.clone();
                targetPos.add(new THREE.Vector3(cameraOffset.x, cameraOffset.y, cameraOffset.z));
                
                // Smooth camera transition
                animateCameraTo(targetPos, centerObject.position);
            }
        }

        function followPlanet() {
            followMode = !followMode;
            const followBtn = document.getElementById('follow-btn');
            
            if (followMode) {
                followBtn.textContent = currentLanguage === 'en' ? 'Stop Following' : '停止跟随';
                followBtn.classList.add('active');
                controls.enabled = false; // Disable manual camera control
            } else {
                followBtn.textContent = currentLanguage === 'en' ? 'Follow Planet' : '跟随行星';
                followBtn.classList.remove('active');
                controls.enabled = true; // Enable manual camera control
            }
        }

        function getCenterObject(centerKey) {
            if (centerKey === 'sun') {
                return sun;
            }
            return planets.find(planet => planet.userData.planetKey === centerKey);
        }

        function updateCameraPosition() {
            if (!followMode) return;
            
            const centerObject = getCenterObject(observationCenter);
            if (centerObject) {
                const targetPos = centerObject.position.clone();
                targetPos.add(new THREE.Vector3(cameraOffset.x, cameraOffset.y, cameraOffset.z));
                
                camera.position.lerp(targetPos, 0.05);
                camera.lookAt(centerObject.position);
            }
        }

        function animateCameraTo(targetPosition, lookAtPosition) {
            const startPos = camera.position.clone();
            const startTime = Date.now();
            const duration = 2000; // 2 seconds
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Smooth easing function
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                
                camera.position.lerpVectors(startPos, targetPosition, easeProgress);
                camera.lookAt(lookAtPosition);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Update controls target
                    controls.target.copy(lookAtPosition);
                    controls.update();
                }
            }
            
            animate();
        }

        function updateToggleButtonTexts() {
            const orbitBtn = document.getElementById('toggle-orbits');
            orbitBtn.textContent = showOrbits ? 
                (currentLanguage === 'en' ? 'Hide Orbits' : '隐藏轨道') : 
                (currentLanguage === 'en' ? 'Show Orbits' : '显示轨道');
                
            const moonBtn = document.getElementById('toggle-moons');
            moonBtn.textContent = showMoons ? 
                (currentLanguage === 'en' ? 'Hide Moons' : '隐藏卫星') : 
                (currentLanguage === 'en' ? 'Show Moons' : '显示卫星');
                
            const asteroidBtn = document.getElementById('toggle-asteroids');
            asteroidBtn.textContent = showAsteroids ? 
                (currentLanguage === 'en' ? 'Hide Asteroids' : '隐藏小行星') : 
                (currentLanguage === 'en' ? 'Show Asteroids' : '显示小行星');
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Keyboard shortcuts for quick planet switching
        window.addEventListener('keydown', (event) => {
            const keyMap = {
                '1': 'sun',
                '2': 'mercury', 
                '3': 'venus',
                '4': 'earth',
                '5': 'mars',
                '6': 'jupiter',
                '7': 'saturn',
                '8': 'uranus',
                '9': 'neptune'
            };
            
            if (keyMap[event.key]) {
                document.getElementById('observation-center').value = keyMap[event.key];
                setObservationCenter(keyMap[event.key]);
            }
            
            // Space bar to toggle follow mode
            if (event.code === 'Space') {
                event.preventDefault();
                followPlanet();
            }
        });

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>